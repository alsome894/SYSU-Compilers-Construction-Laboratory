#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
使用 automata-lib 定义并可视化识别十进制浮点数 DFA（含指数形式）
"""

from automata.fa.dfa import DFA

transitions = {
    '0': {
        '+': '32',
        'digit': '10',
        '&': '41',
        'c': '21',
        'f': '5',
        '>': '34',
        '<': '36',
        'm': '24',
        's': '18',
        't': '1',
        '(': '16',
        ')': '17',
        '^': '29',
        '*': '30',
        '/': '31',
        '?': '43',
        '-': '33',
        '=': '39',
        '!': '40',
        ':': '44',
        '|': '42',
        ',': '45',
    },
    '32': {},
    '10': {'.':'11','E':'13','e':'13','digit':'10'},
    '11': {'digit':'12'},
    '12': {'E':'13','e':'13','digit':'12'},
    '13': {'+':'14','-':'14','digit':'15'},
    '14': {'digit':'15'},
    '15': {'digit':'15'},
    '41': {},
    '21': {'o': '22'},
    '22': {'s': '23'},
    '23': {},
    '5': {'a': '6'},
    '6': {'l': '7'},
    '7': {'s': '8'},
    '8': {'e': '9'},
    '9': {},
    '34': {'=': '35'},
    '35': {},
    '36': {'=': '37', '>': '38'},
    '37': {},
    '38': {},
    '24': {'a': '25', 'i': '27'},
    '25': {'x': '26'},
    '26': {},
    '27': {'n': '28'},
    '28': {},
    '18': {'i': '19'},
    '19': {'n': '20'},
    '20': {},
    '1': {'r': '2'},
    '2': {'u': '3'},
    '3': {'e': '4'},
    '4': {},
    '16': {},
    '17': {},
    '29': {},
    '30': {},
    '31': {},
    '43': {},
    '33': {},
    '39': {},
    '40': {},
    '44': {},
    '42': {},
    '45': {},
}

def main():
    dfa_decimal = DFA(
        states={'0', '1', '2', '3', '4', '5', '6', '7', '8', '9','10','11','12','13','14','15','16','17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28','29','30','31','32','33', '34', '35', '36', '37', '38','39','40','41','42','43','44','45'},
        input_symbols={'(',')','^','*','/','+','-','=','!','&','|','?',':',',','t', 'r', 'u', 'e','s', 'i', 'n','m', 'a', 'x', 'i', 'n','<', '=', '>','>', '=','f', 'a', 'l', 's', 'e','c', 'o', 's','digit','.','E','e','+','-'},
        transitions=transitions,
        initial_state='0',
        final_states={ '4', '9','10','12','15','16','17', '20', '23', '26', '28','29','30','31','32','33', '34', '35', '36', '37', '38','39','40','41','42','43','44','45'},
        allow_partial=True
    )

    output_file = 'dfa.png'
    dfa_decimal.show_diagram(path=output_file)
    print(f"DFA 可视化图已保存至：{output_file}")

if __name__ == '__main__':
    main()